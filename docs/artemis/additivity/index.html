<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>artemis.additivity API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>artemis.additivity</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">from ._additivity_meter import AdditivityMeter

__all__ = [&#34;AdditivityMeter&#34;]</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="artemis.additivity.AdditivityMeter"><code class="flex name class">
<span>class <span class="ident">AdditivityMeter</span></span>
<span>(</span><span>random_state: Optional[int] = None)</span>
</code></dt>
<dd>
<div class="desc"><p>AdditivityMeter is a class that calculates the additivity index of a model.</p>
<h2 id="attributes">Attributes</h2>
<dl>
<dt><strong><code>additivity_index</code></strong> :&ensp;<code>float</code></dt>
<dd>Additivity index of the model.</dd>
<dt><strong><code>full_result</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>Dataframe with the results of the additivity index calculation.
It contains centered partial dependence values and prediction for every observation and feature.</dd>
<dt><strong><code>preds</code></strong> :&ensp;<code>np.ndarray</code></dt>
<dd>Predictions for the sampled data.</dd>
<dt><strong><code>model</code></strong> :&ensp;<code>object</code></dt>
<dd>Model for which additivity index is calculated.</dd>
<dt><strong><code>X_sampled</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>Sampled data used for calculation.</dd>
<dt><strong><code>pd_calculator</code></strong> :&ensp;<code>PartialDependenceCalculator</code></dt>
<dd>Object used to calculate and store partial dependence values.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class AdditivityMeter:
    &#34;&#34;&#34;
    AdditivityMeter is a class that calculates the additivity index of a model.

    Attributes
    -----------
    additivity_index : float
        Additivity index of the model.
    full_result : pd.DataFrame
        Dataframe with the results of the additivity index calculation. 
        It contains centered partial dependence values and prediction for every observation and feature.
    preds: np.ndarray
        Predictions for the sampled data.
    model : object
        Model for which additivity index is calculated.
    X_sampled: pd.DataFrame
        Sampled data used for calculation.
    pd_calculator : PartialDependenceCalculator
        Object used to calculate and store partial dependence values.    
    &#34;&#34;&#34;
    def __init__(self, random_state: Optional[int] = None):
        self._random_generator = np.random.default_rng(random_state)
        self.additivity_index = None
        self.full_result = None
        self.pred = None
        self.model = None
        self.X_smapled = None
        self.pd_calculator = None
        self

    def fit(
        self,
        model,
        X: pd.DataFrame,
        n: int = None,
        predict_function: Optional[Callable] = None,
        show_progress: bool = False,
        batchsize: int = 2000,
        pd_calculator: Optional[PartialDependenceCalculator] = None,
    ):
        &#34;&#34;&#34; 
        Calculates the additivity index of the given model.

        Parameters
        -----------
        model : object
            Model to calculate additivity index for, should have predict_proba or predict method, or predict_function should be provided. 
        X : pd.DataFrame
            Data used to calculate the additivity index. If n is not None, n rows from X will be sampled. 
        n : int, optional
            Number of samples to be used for calculation of the additivity index. If None, all rows from X will be used. Default is None.
        predict_function : Callable, optional
            Function used to predict model output. It should take model and dataset and outputs predictions. 
            If None, `predict_proba` method will be used if it exists, otherwise `predict` method. Default is None.
        show_progress : bool
            If True, progress bar will be shown. Default is False.
        batchsize : int
            Batch size for calculating partial dependence. Prediction requests are collected until the batchsize is exceeded, 
            then the model is queried for predictions jointly for many observations. It speeds up the operation of the method.
            Default is 2000.
        pd_calculator : PartialDependenceCalculator, optional
            PartialDependenceCalculator object containing partial dependence values for a given model and dataset. 
            Providing this object speeds up the calculation as partial dependence values do not need to be recalculated.
            If None, it will be created from scratch. Default is None.

        Returns
        --------
        additivity_index : float
            Additivity index of the model. Value from [0, 1] interval where 1 means that the model is additive, 
            and 0 means that the model is not additive.
        &#34;&#34;&#34;
        self.predict_function = get_predict_function(model, predict_function)
        self.model = model
        self.X_sampled = sample_if_not_none(self._random_generator, X, n)

        if pd_calculator is None:
            self.pd_calculator = PartialDependenceCalculator(
                self.model, self.X_sampled, self.predict_function, batchsize
            )
        else:
            if pd_calculator.model != self.model:
                raise ValueError(
                    &#34;Model in PDP calculator is different than the model in the method.&#34;
                )
            if not pd_calculator.X.equals(self.X_sampled):
                raise ValueError(
                    &#34;Data in PDP calculator is different than the data in the method.&#34;
                )
            self.pd_calculator = pd_calculator

        self.full_result = self.X_sampled.copy()
        self.additivity_index = self._calculate_additivity(show_progress=show_progress)
        return self.additivity_index

    def _calculate_additivity(self, show_progress: bool):
        self.pd_calculator.calculate_pd_single(
            show_progress=show_progress, desc=ProgressInfoLog.CALC_ADD
        )

        self.preds = self.predict_function(self.model, self.X_sampled)
        for var in self.X_sampled.columns:
            self.full_result[var] = self.pd_calculator.get_pd_single(var, self.X_sampled[var].values) - np.mean(self.preds)

        self.full_result = self.full_result
        self.full_result[&#34;centered_prediction&#34;] = self.preds - np.mean(self.preds)

        sum_first_order_effects = self.full_result.values[:, :-1].sum(axis=1) + np.mean(self.preds)
        return 1-np.sum((self.preds - sum_first_order_effects)**2) / np.sum((self.full_result[&#34;centered_prediction&#34;])**2)</code></pre>
</details>
<h3>Methods</h3>
<dl>
<dt id="artemis.additivity.AdditivityMeter.fit"><code class="name flex">
<span>def <span class="ident">fit</span></span>(<span>self, model, X: pandas.core.frame.DataFrame, n: int = None, predict_function: Optional[Callable] = None, show_progress: bool = False, batchsize: int = 2000, pd_calculator: Optional[artemis._utilities.pd_calculator.PartialDependenceCalculator] = None)</span>
</code></dt>
<dd>
<div class="desc"><p>Calculates the additivity index of the given model.</p>
<h2 id="parameters">Parameters</h2>
<dl>
<dt><strong><code>model</code></strong> :&ensp;<code>object</code></dt>
<dd>Model to calculate additivity index for, should have predict_proba or predict method, or predict_function should be provided.</dd>
<dt><strong><code>X</code></strong> :&ensp;<code>pd.DataFrame</code></dt>
<dd>Data used to calculate the additivity index. If n is not None, n rows from X will be sampled.</dd>
<dt><strong><code>n</code></strong> :&ensp;<code>int</code>, optional</dt>
<dd>Number of samples to be used for calculation of the additivity index. If None, all rows from X will be used. Default is None.</dd>
<dt><strong><code>predict_function</code></strong> :&ensp;<code>Callable</code>, optional</dt>
<dd>Function used to predict model output. It should take model and dataset and outputs predictions.
If None, <code>predict_proba</code> method will be used if it exists, otherwise <code>predict</code> method. Default is None.</dd>
<dt><strong><code>show_progress</code></strong> :&ensp;<code>bool</code></dt>
<dd>If True, progress bar will be shown. Default is False.</dd>
<dt><strong><code>batchsize</code></strong> :&ensp;<code>int</code></dt>
<dd>Batch size for calculating partial dependence. Prediction requests are collected until the batchsize is exceeded,
then the model is queried for predictions jointly for many observations. It speeds up the operation of the method.
Default is 2000.</dd>
<dt><strong><code>pd_calculator</code></strong> :&ensp;<code>PartialDependenceCalculator</code>, optional</dt>
<dd>PartialDependenceCalculator object containing partial dependence values for a given model and dataset.
Providing this object speeds up the calculation as partial dependence values do not need to be recalculated.
If None, it will be created from scratch. Default is None.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><strong><code>additivity_index</code></strong> :&ensp;<code>float</code></dt>
<dd>Additivity index of the model. Value from [0, 1] interval where 1 means that the model is additive,
and 0 means that the model is not additive.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def fit(
    self,
    model,
    X: pd.DataFrame,
    n: int = None,
    predict_function: Optional[Callable] = None,
    show_progress: bool = False,
    batchsize: int = 2000,
    pd_calculator: Optional[PartialDependenceCalculator] = None,
):
    &#34;&#34;&#34; 
    Calculates the additivity index of the given model.

    Parameters
    -----------
    model : object
        Model to calculate additivity index for, should have predict_proba or predict method, or predict_function should be provided. 
    X : pd.DataFrame
        Data used to calculate the additivity index. If n is not None, n rows from X will be sampled. 
    n : int, optional
        Number of samples to be used for calculation of the additivity index. If None, all rows from X will be used. Default is None.
    predict_function : Callable, optional
        Function used to predict model output. It should take model and dataset and outputs predictions. 
        If None, `predict_proba` method will be used if it exists, otherwise `predict` method. Default is None.
    show_progress : bool
        If True, progress bar will be shown. Default is False.
    batchsize : int
        Batch size for calculating partial dependence. Prediction requests are collected until the batchsize is exceeded, 
        then the model is queried for predictions jointly for many observations. It speeds up the operation of the method.
        Default is 2000.
    pd_calculator : PartialDependenceCalculator, optional
        PartialDependenceCalculator object containing partial dependence values for a given model and dataset. 
        Providing this object speeds up the calculation as partial dependence values do not need to be recalculated.
        If None, it will be created from scratch. Default is None.

    Returns
    --------
    additivity_index : float
        Additivity index of the model. Value from [0, 1] interval where 1 means that the model is additive, 
        and 0 means that the model is not additive.
    &#34;&#34;&#34;
    self.predict_function = get_predict_function(model, predict_function)
    self.model = model
    self.X_sampled = sample_if_not_none(self._random_generator, X, n)

    if pd_calculator is None:
        self.pd_calculator = PartialDependenceCalculator(
            self.model, self.X_sampled, self.predict_function, batchsize
        )
    else:
        if pd_calculator.model != self.model:
            raise ValueError(
                &#34;Model in PDP calculator is different than the model in the method.&#34;
            )
        if not pd_calculator.X.equals(self.X_sampled):
            raise ValueError(
                &#34;Data in PDP calculator is different than the data in the method.&#34;
            )
        self.pd_calculator = pd_calculator

    self.full_result = self.X_sampled.copy()
    self.additivity_index = self._calculate_additivity(show_progress=show_progress)
    return self.additivity_index</code></pre>
</details>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="artemis" href="../index.html">artemis</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="artemis.additivity.AdditivityMeter" href="#artemis.additivity.AdditivityMeter">AdditivityMeter</a></code></h4>
<ul class="">
<li><code><a title="artemis.additivity.AdditivityMeter.fit" href="#artemis.additivity.AdditivityMeter.fit">fit</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>